<mat-card class="main-card">
  <h1 class="title">üß™ Analyse m√©dicale</h1>

  <form (ngSubmit)="submitAnalysis()" #formRef="ngForm" class="form-layout">
    <!-- Informations personnelles -->
    <div class="form-row">
      <mat-form-field appearance="fill">
        <mat-label>Pr√©nom</mat-label>
        <input matInput [(ngModel)]="form.firstName" name="firstName" required />
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Nom</mat-label>
        <input matInput [(ngModel)]="form.lastName" name="lastName" required />
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Date de naissance</mat-label>
        <input matInput type="date" [(ngModel)]="form.birthDate" name="birthDate" required />
      </mat-form-field>
    </div>

    <!-- Sexe et mesures -->
    <div class="form-row">
      <mat-form-field appearance="fill">
        <mat-label>Sexe</mat-label>
        <mat-select [(ngModel)]="form.gender" name="gender" required>
          <mat-option value="Homme">Homme</mat-option>
          <mat-option value="Femme">Femme</mat-option>
          <mat-option value="Autre">Autre</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Taille (cm)</mat-label>
        <input matInput type="number" [(ngModel)]="form.height" name="height" required />
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Poids (kg)</mat-label>
        <input matInput type="number" [(ngModel)]="form.weight" name="weight" required />
      </mat-form-field>
    </div>

    <!-- Sympt√¥mes -->
    <mat-form-field appearance="fill" class="symptom-field">
      <mat-label>Sympt√¥mes</mat-label>
      <input
        matInput
        [(ngModel)]="currentSymptom"
        name="symptomTemp"
        [matAutocomplete]="autoSymptom"
        (keydown.enter)="addSymptom(); $event.preventDefault()" />
      <mat-autocomplete #autoSymptom="matAutocomplete">
        <mat-option *ngFor="let s of symptomSuggestions" [value]="s">{{ s }}</mat-option>
      </mat-autocomplete>
    </mat-form-field>

    <div *ngIf="form.symptomNames.length" class="custom-chip-list">
      <span *ngFor="let s of form.symptomNames; let i = index" class="chip">
        {{ s }}
        <button type="button" (click)="removeSymptom(i)">‚ùå</button>
      </span>
    </div>

    <!-- Marqueur + Valeur -->
    <div class="form-row">
      <mat-form-field appearance="fill">
        <mat-label>Marqueur</mat-label>
        <input
          matInput
          [(ngModel)]="form.biologicalResults[0].markerName"
          name="markerName-0"
          [matAutocomplete]="autoMarker" />
        <mat-autocomplete #autoMarker="matAutocomplete">
          <mat-option *ngFor="let marker of markerSuggestions" [value]="marker">
            {{ marker }}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Valeur</mat-label>
        <input
          matInput
          type="number"
          [(ngModel)]="form.biologicalResults[0].value"
          name="value-0"
          required />
      </mat-form-field>
    </div>

    <!-- Boutons -->
    <div class="button-group">
      <button mat-flat-button color="primary" type="submit" [disabled]="loading">Analyser</button>
      <button mat-stroked-button type="button" (click)="resetForm()">R√©initialiser</button>
    </div>
  </form>

  <!-- R√©sum√© & PDF -->
  <mat-card *ngIf="response" class="result-card">
    <p>‚úÖ Analyse termin√©e</p>
    <button mat-stroked-button (click)="exportPdf()">üìÑ T√©l√©charger PDF</button>
  </mat-card>
</mat-card>
